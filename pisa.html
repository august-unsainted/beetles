<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∂—É–∂–µ–ª–∏—Ü</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <style>
    /* Select2 —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bootstrap */
    .select2-container--default .select2-selection--multiple {
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      background-color: #fff;
      transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .select2-container {
      width: 100% !important;
    }


    .select2-container--default.select2-container--focus .select2-selection--multiple {
      border-color: #86b7fe;
      box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice {
      background-color: #e9ecef;
      border: 1px solid #adb5bd;
      border-radius: 0.25rem;
      color: #495057;
      transition: background-color 0.15s ease-in-out;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice:hover {
      background-color: #dee2e6;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
      color: #6c757d;
      transition: color 0.15s ease-in-out;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
      color: #dc3545;
    }

    .select2-dropdown {
      border: 1px solid #ced4da;
      border-radius: 0.375rem;
      box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      z-index: 15000;
    }

    .select2-results__option {
      transition: background-color 0.15s ease-in-out;
    }

    .select2-results__option--highlighted {
      background-color: #0d6efd !important;
      color: #fff;
    }

    .select2-results__option--selected {
      background-color: #f8f9fa;
      color: #495057;
    }

    .select2-selection__choice__remove>span {
      padding-bottom: 6px;
    }

    .select2-container--default .select2-selection--multiple .select2-selection__choice__display {
      padding-left: 6px;
      padding-right: 10px;
    }

    /* –°—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã */
    .gridjs-th {
      padding: 6px !important;
    }

    .highlight-column {
      background-color: rgba(255, 235, 59, 0.3) !important;
      transition: background-color 0.2s;
    }



    /* –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å –º–æ–¥–∞–ª–∫–∏ */
    .modal-body {
      padding: 0.75rem 1rem;
    }

    .modal-body .row {
      margin-bottom: 0.5rem;
    }

    .modal-body .form-label {
      margin-bottom: 0.15rem;
      font-size: 0.8rem;
      font-weight: 500;
      color: #212529;
    }

    .modal-body .form-control,
    .modal-body .form-select {
      font-size: 0.8rem;
      padding: 0.25rem 0.5rem;
      height: auto;
    }

    .modal-body h6 {
      font-size: 0.875rem;
      margin-bottom: 0.375rem;
      margin-top: 0.75rem;
    }

    .modal-body h6:first-child {
      margin-top: 0;
    }

    .modal-body textarea {
      resize: none;
    }



    .toggle-geography,
    .toggle-images {
      cursor: pointer;
      color: #0d6efd;
      text-decoration: underline;
      font-size: 0.8rem;
    }

    .toggle-geography:hover,
    .toggle-images:hover {
      color: #0a58ca;
    }

    .modal-section {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 0.375rem;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .modal-section h6 {
      color: #495057;
      font-weight: 600;
      margin-bottom: 0.5rem;
      margin-top: 0;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <div class="container-fluid py-4 px-3">
    <div class="card border-0">
      <div class="card-body">
        <section class="mb-4">
          <div class="d-flex flex-column flex-md-row px-0 justify-content-between align-items-start gap-3 w-100">
            <div class="w-100 w-md-50">
              <h1 class="fw-bold text-primary mb-3">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∂—É–∂–µ–ª–∏—Ü</h1>
              <button type="button" class="btn btn-primary w-100 w-md-auto" style="min-width: 180px;"
                data-bs-toggle="modal" data-bs-target="#createBeetleModal">
                + –°–æ–∑–¥–∞—Ç—å –∂—É–∂–µ–ª–∏—Ü—É
              </button>
            </div>
            <fieldset class="w-100 w-md-50" style="min-width: 260px;">
              <legend class="fs-6 text-muted mb-2">–ü—Ä–∏–∑–Ω–∞–∫–∏</legend>
              <div class="d-flex flex-wrap gap-2" id="chooseColumns">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="toggleAllColumns" checked>
                  <label class="form-check-label" for="toggleAllColumns">
                    <strong>–í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏</strong>
                  </label>
                </div>
              </div>
            </fieldset>
          </div>
        </section>

        <div style="display: none;">
          <table id="data_table">
            <tbody>
              <tr>
                <td>–ü–æ–¥—Å–µ–º–µ–π—Å—Ç–≤–æ 1</td>
                <td>–¢—Ä–∏–±–∞ 1</td>
                <td>–†–æ–¥ 1</td>
                <td>–ü–æ–¥—Ä–æ–¥ 1</td>
                <td>–í–∏–¥ 1</td>
                <td>–†–∞–π–æ–Ω 1</td>
                <td>–ü—É–Ω–∫—Ç 1</td>
                <td>–®–∏—Ä–æ—Ç–Ω–∞—è 1</td>
                <td>–î–æ–ª–≥–æ—Ç–Ω–∞—è 1</td>
                <td>–≠–∫–æ –≥—Ä—É–ø–ø–∞ 1</td>
                <td>–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è 1</td>
                <td>–Ø—Ä—É—Å–Ω–∞—è 1</td>
                <td>–û–ø–∏—Å–∞–Ω–∏–µ 1</td>
              </tr>
              <tr>
                <td>–ü–æ–¥—Å–µ–º–µ–π—Å—Ç–≤–æ 2</td>
                <td>–¢—Ä–∏–±–∞ 2</td>
                <td>–†–æ–¥ 2</td>
                <td>–ü–æ–¥—Ä–æ–¥ 2</td>
                <td>–í–∏–¥ 2</td>
                <td>–†–∞–π–æ–Ω 2</td>
                <td>–ü—É–Ω–∫—Ç 2</td>
                <td>–®–∏—Ä–æ—Ç–Ω–∞—è 2</td>
                <td>–î–æ–ª–≥–æ—Ç–Ω–∞—è 2</td>
                <td>–≠–∫–æ –≥—Ä—É–ø–ø–∞ 2</td>
                <td>–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è 2</td>
                <td>–Ø—Ä—É—Å–Ω–∞—è 2</td>
                <td>–û–ø–∏—Å–∞–Ω–∏–µ 2</td>
              </tr>
              <tr>
                <td>–ü–æ–¥—Å–µ–º–µ–π—Å—Ç–≤–æ 3</td>
                <td>–¢—Ä–∏–±–∞ 3</td>
                <td>–†–æ–¥ 3</td>
                <td>–ü–æ–¥—Ä–æ–¥ 3</td>
                <td>–í–∏–¥ 3</td>
                <td>–†–∞–π–æ–Ω 3</td>
                <td>–ü—É–Ω–∫—Ç 3</td>
                <td>–®–∏—Ä–æ—Ç–Ω–∞—è 3</td>
                <td>–î–æ–ª–≥–æ—Ç–Ω–∞—è 3</td>
                <td>–≠–∫–æ –≥—Ä—É–ø–ø–∞ 3</td>
                <td>–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è 3</td>
                <td>–Ø—Ä—É—Å–Ω–∞—è 3</td>
                <td>–û–ø–∏—Å–∞–Ω–∏–µ 3</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div id="table-wrapper" class="rounded"></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsModalLabel">–î–µ—Ç–∞–ª–∏ –∂—É–∂–µ–ª–∏—Ü—ã</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editForm">
            <input type="hidden" id="edit_id" name="id">

            <div class="modal-section">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0" style="color: black;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h6>
                <span class="toggle-images" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏">
                  –ø–æ–∫–∞–∑–∞—Ç—å
                </span>
              </div>
              <div class="row" id="images-section" style="display: none;">
                <div class="col-12">
                  <input type="file" class="form-control" id="edit_image" accept="image/*" style="display: none;">
                  <div class="mb-2" id="image-preview">
                    <img
                      src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zNWVtIj7QndC10YIg0LjQt9C+0LHRgNCw0LbQtdC90LjRjzwvdGV4dD4KICA8L3N2Zz4K"
                      class="img-thumbnail" style="max-width: 200px; max-height: 150px;">
                  </div>
                  <div class="d-flex gap-2 flex-wrap">
                    <button type="button" class="btn btn-outline-primary btn-sm"
                      onclick="$('#edit_image').click()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-outline-danger btn-sm" id="delete-image">–£–¥–∞–ª–∏—Ç—å</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="modal-section">
              <h6 style="color: black;">–¢–∞–∫—Å–æ–Ω–æ–º–∏—è</h6>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">–†–æ–¥</label>
                  <input type="text" class="form-control" id="edit_genus" list="genus-list" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥">
                  <datalist id="genus-list">
                    <option value="–†–æ–¥ 1">
                    <option value="–†–æ–¥ 2">
                  </datalist>
                </div>
                <div class="col-md-4">
                  <label class="form-label">–ü–æ–¥—Ä–æ–¥</label>
                  <input type="text" class="form-control" id="edit_subgenus" list="subgenus-list"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ä–æ–¥">
                  <datalist id="subgenus-list">
                    <option value="–ü–æ–¥—Ä–æ–¥ 1">
                    <option value="–ü–æ–¥—Ä–æ–¥ 2">
                  </datalist>
                </div>
                <div class="col-md-4">
                  <label class="form-label">–í–∏–¥</label>
                  <input type="text" class="form-control" id="edit_species">
                </div>
              </div>
            </div>

            <div class="modal-section">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0" style="color: black;">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</h6>
                <span class="toggle-geography" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏">
                  –ø–æ–∫–∞–∑–∞—Ç—å
                </span>
              </div>
              <div class="row" id="geography-section">
                <div class="col-md-6">
                  <label class="form-label">–†–µ–≥–∏–æ–Ω—ã</label>
                  <select class="form-control multiple-select" id="edit_regions" multiple>
                    <option value="1">–ë–∞—Ä–≥—É–∑–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="2">–ë–∏—á—É—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="3">–î–∂–∏–¥–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="4">–ó–∞–∏–≥—Ä–∞–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="5">–ó–∞–∫–∞–º–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">–¢–æ—á–∫–∏</label>
                  <select class="form-control multiple-select" id="edit_points" multiple>
                    <option value="1" data-region="1">–£—Å—Ç—å-–ë–∞—Ä–≥—É–∑–∏–Ω</option>
                    <option value="2" data-region="1">–ë–∞—Ä–≥—É–∑–∏–Ω</option>
                    <option value="3" data-region="2">–ë–∏—á—É—Ä–∞</option>
                    <option value="4" data-region="2">–ù–æ–≤–æ—Å—Ä–µ—Ç–µ–Ω—Å–∫–æ–µ</option>
                    <option value="5" data-region="3">–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤–∫–∞</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="modal-section">
              <h6 style="color: black;">–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã</h6>
              <div class="row">
                <div class="col-md-3">
                  <label class="form-label">–®–∏—Ä–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                  <input type="text" class="form-control" id="edit_width_range" list="width-list"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É">
                  <datalist id="width-list">
                    <option value="–®–∏—Ä–æ–∫–∞—è">
                    <option value="–£–∑–∫–∞—è">
                  </datalist>
                </div>
                <div class="col-md-3">
                  <label class="form-label">–î–æ–ª–≥–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                  <input type="text" class="form-control" id="edit_long_range" list="long-list"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É">
                  <datalist id="long-list">
                    <option value="–î–ª–∏–Ω–Ω–∞—è">
                    <option value="–ö–æ—Ä–æ—Ç–∫–∞—è">
                  </datalist>
                </div>
                <div class="col-md-3">
                  <label class="form-label">–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞</label>
                  <input type="text" class="form-control" id="edit_ecologic_group" list="ecologic-list"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É">
                  <datalist id="ecologic-list">
                    <option value="–õ–µ—Å–Ω–∞—è">
                    <option value="–°—Ç–µ–ø–Ω–∞—è">
                  </datalist>
                </div>
                <div class="col-md-3">
                  <label class="form-label">–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞</label>
                  <input type="text" class="form-control" id="edit_trophic_group" list="trophic-list"
                    placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É">
                  <datalist id="trophic-list">
                    <option value="–•–∏—â–Ω–∏–∫">
                    <option value="–¢—Ä–∞–≤–æ—è–¥–Ω—ã–π">
                  </datalist>
                </div>
              </div>
            </div>

            <div class="modal-section">
              <h6 style="color: black;">–û–ø–∏—Å–∞–Ω–∏–µ</h6>
              <div class="row">
                <div class="col-12">
                  <textarea class="form-control" id="edit_description" rows="2"></textarea>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" name="delete" onclick="submitForm()"
            class="btn btn-danger btn-sm me-auto">–£–¥–∞–ª–∏—Ç—å</button>
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
          <button type="button" name="apply" onclick="submitForm()" class="btn btn-primary btn-sm">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="createBeetleModal" tabindex="-1" aria-labelledby="createBeetleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createBeetleModalLabel">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∂—É–∂–µ–ª–∏—Ü—É</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="createForm">
            <div class="modal-section">
              <h6>–¢–∞–∫—Å–æ–Ω–æ–º–∏—è</h6>
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">–†–æ–¥</label>
                  <select class="form-control" id="create_genus">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥</option>
                    <option value="–†–æ–¥ 1">–†–æ–¥ 1</option>
                    <option value="–†–æ–¥ 2">–†–æ–¥ 2</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">–ü–æ–¥—Ä–æ–¥</label>
                  <select class="form-control" id="create_subgenus">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ä–æ–¥</option>
                    <option value="–ü–æ–¥—Ä–æ–¥ 1">–ü–æ–¥—Ä–æ–¥ 1</option>
                    <option value="–ü–æ–¥—Ä–æ–¥ 2">–ü–æ–¥—Ä–æ–¥ 2</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">–í–∏–¥</label>
                  <input type="text" class="form-control" id="create_species">
                </div>
              </div>
            </div>

            <div class="modal-section-divider">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0 text-muted">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</h6>
                <button type="button" class="btn btn-sm btn-outline-secondary toggle-geography"
                  title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏">
                  üëÅÔ∏è
                </button>
              </div>
              <div class="row mb-3" id="geography-section-create">
                <div class="col-md-6">
                  <label class="form-label">–†–µ–≥–∏–æ–Ω—ã</label>
                  <select class="form-control multiple-select" id="create_regions" multiple>
                    <option value="1">–ë–∞—Ä–≥—É–∑–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="2">–ë–∏—á—É—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="3">–î–∂–∏–¥–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="4">–ó–∞–∏–≥—Ä–∞–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                    <option value="5">–ó–∞–∫–∞–º–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label">–¢–æ—á–∫–∏</label>
                  <select class="form-control multiple-select" id="create_points" multiple>
                    <option value="1" data-region="1">–£—Å—Ç—å-–ë–∞—Ä–≥—É–∑–∏–Ω</option>
                    <option value="2" data-region="1">–ë–∞—Ä–≥—É–∑–∏–Ω</option>
                    <option value="3" data-region="2">–ë–∏—á—É—Ä–∞</option>
                    <option value="4" data-region="2">–ù–æ–≤–æ—Å—Ä–µ—Ç–µ–Ω—Å–∫–æ–µ</option>
                    <option value="5" data-region="3">–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤–∫–∞</option>
                  </select>
                </div>
              </div>
            </div>

            <h6 class="mb-2 text-muted">–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã</h6>
            <div class="row mb-3">
              <div class="col-md-3">
                <label class="form-label">–®–∏—Ä–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                <select class="form-control" id="create_width_range">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                  <option value="–®–∏—Ä–æ–∫–∞—è">–®–∏—Ä–æ–∫–∞—è</option>
                  <option value="–£–∑–∫–∞—è">–£–∑–∫–∞—è</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">–î–æ–ª–≥–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞</label>
                <select class="form-control" id="create_long_range">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                  <option value="–î–ª–∏–Ω–Ω–∞—è">–î–ª–∏–Ω–Ω–∞—è</option>
                  <option value="–ö–æ—Ä–æ—Ç–∫–∞—è">–ö–æ—Ä–æ—Ç–∫–∞—è</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞</label>
                <select class="form-control" id="create_ecologic_group">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                  <option value="–õ–µ—Å–Ω–∞—è">–õ–µ—Å–Ω–∞—è</option>
                  <option value="–°—Ç–µ–ø–Ω–∞—è">–°—Ç–µ–ø–Ω–∞—è</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞</label>
                <select class="form-control" id="create_trophic_group">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                  <option value="–•–∏—â–Ω–∏–∫">–•–∏—â–Ω–∏–∫</option>
                  <option value="–¢—Ä–∞–≤–æ—è–¥–Ω—ã–π">–¢—Ä–∞–≤–æ—è–¥–Ω—ã–π</option>
                </select>
              </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-2 mt-3">
          <h6 class="mb-0 text-muted">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h6>
          <button type="button" class="btn btn-sm btn-outline-secondary toggle-images"
            title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏">
            üì∑
          </button>
        </div>
        <div class="row mb-3" id="images-section-create" style="display: none;">
          <div class="col-12">
            <input type="file" class="form-control" id="create_image" accept="image/*" style="display: none;">
            <div class="d-flex gap-1 flex-wrap">
              <button type="button" class="btn btn-outline-primary btn-sm"
                onclick="$('#create_image').click()">üìÅ</button>
              <button type="button" class="btn btn-outline-info btn-sm" id="view-image-create">üëÅÔ∏è</button>
              <button type="button" class="btn btn-outline-danger btn-sm" id="delete-image-create">üóëÔ∏è</button>
            </div>
            <div class="mt-2" id="image-preview-create"></div>
          </div>
        </div>

        <h6 class="mb-2 text-muted mt-3">–û–ø–∏—Å–∞–Ω–∏–µ</h6>
        <div class="row">
          <div class="col-12">
            <textarea class="form-control" id="create_description" rows="2"></textarea>
          </div>
        </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-success btn-sm" id="createBeetleBtn">–°–æ–∑–¥–∞—Ç—å</button>
      </div>
    </div>
  </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    class TableManager {
      constructor(type) {
        this.grid = null;
        this.btnDetails = `<button class="btn btn-secondary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#detailsModal">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>`;
        this.loadData();
        this.getColumns(type);
        this.columnIndexMap = {};
        this.name = name;
      }

      init() {
        this.initSelect2();
        this.syncColumnsState();
        this.renderTable();
        this.fillFieldset();
        this.bindEvents();
        this.bindToggleAllSwitch();
        this.bindHighlightColumns();
      }

      initSelect2() {
        $('.multiple-select')
          .select2({ placeholder: '–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏' })
          .on('select2:unselect', function (e) {
            let id = this.id;
            const isRegions = id.endsWith('regions');
            const modal = id.split('_')[0];
            const $points = $(`#${modal}_points`);
            const pointsValues = $points.val();
            const region = isRegions
              ? e.params.data.id
              : $(e.params.data.element).attr('data-region');

            let regionOptions = [];

            $points.find(`option[data-region="${region}"]`).each((_, option) => {
              if (pointsValues.includes(option.value)) {
                isRegions
                  ? pointsValues.splice(pointsValues.indexOf(option.value), 1)
                  : regionOptions.push(option);
              }
            });

            if (isRegions) {
              $points.val(pointsValues).trigger('change');
            } else if (!regionOptions.length) {
              const regions = $(`#${modal}_regions`).val();
              regions.splice(regions.indexOf(region), 1);
              $(`#${modal}_regions`).val(regions).trigger('change');
            }
          })
          .on('select2:select', function (e) {
            if (this.id.endsWith('points')) {
              const modal = this.id.split('_')[0];
              const $regions = $(`#${modal}_regions`);
              const region = $(e.params.data.element).attr('data-region');
              let selectedRegions = $regions.val();
              if (!selectedRegions.includes(region)) {
                selectedRegions.push(region);
                $regions.val(selectedRegions).trigger('change');
              }
            }
          });
      }

      syncColumnsState({ to = 'checkboxes' } = {}) {
        this.columnIndexMap = {};
        this.allColumns.forEach((col, index) => {
          this.columnIndexMap[col.id] = index;
        });

        this.allColumns.forEach((col) => {
          if (col.id === 'actions') return;
          const checkbox = $(`.column-toggle[value="${col.id}"]`);
          if (!checkbox.length) return;
          if (to === 'checkboxes') {
            checkbox.prop('checked', col.visible);
          } else if (to === 'columns') {
            col.visible = checkbox.prop('checked');
          }
        });
      }

      loadData() {
        this.beetles = [];
        $('#data_table tbody tr').each((_, tr) => {
          const row = [];
          $(tr)
            .find('td')
            .each((_, td) => row.push(td.innerText.trim()));
          this.beetles.push(row);
        });
      }

      getColumns(type) {
        let columnsConfig = [];
        let baseColumns = [
          ['–ü–æ–¥—Å–µ–º–µ–π—Å—Ç–≤–æ', 'family'],
          ['–¢—Ä–∏–±–∞', 'tribe'],
          ['–†–æ–¥', 'genus'],
          ['–ü–æ–¥—Ä–æ–¥', 'subgenus'],
          ['–í–∏–¥', 'species'],
        ];
        let geoColumns = [
          ['–†–∞–π–æ–Ω—ã', 'region'],
          ['–ü—É–Ω–∫—Ç—ã', 'points'],
        ];
        let ecoColumns = [
          ['–®–∏—Ä–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞', 'width_range'],
          ['–î–æ–ª–≥–æ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞', 'long_range'],
          ['–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞', 'ecologic_group'],
          ['–¢—Ä–æ—Ñ–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞', 'trophic_group'],
          ['–Ø—Ä—É—Å–Ω–∞—è –≥—Ä—É–ø–ø–∞', 'tiered_group'],
        ];
        let allColumns = [...baseColumns, ...geoColumns, ...ecoColumns];

        for (let i = 0; i < allColumns.length; i++) {
          let column = allColumns[i];
          let isHidden =
            (type == 'geo' && ecoColumns.includes(column)) ||
            (type == 'eco' && geoColumns.includes(column));
          columnsConfig.push({
            name: column[0],
            id: column[1],
            visible: !isHidden,
          });
        }
        columnsConfig.push({
          name: '–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ',
          id: 'description',
          visible: false,
        });
        columnsConfig.push({
          name: '–î–µ–π—Å—Ç–≤–∏—è',
          sort: false,
          visible: true,
          formatter: (_, row) => {
            const originalRowData = row.cells.map((c) => c.data);
            const rowIndex = this.beetles.findIndex(
              (b) =>
                b[0] === originalRowData[0] &&
                b[1] === originalRowData[1] &&
                b[2] === originalRowData[2] &&
                b[3] === originalRowData[3] &&
                b[4] === originalRowData[4]
            );
            return gridjs.html(
              `<button class="btn btn-secondary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#detailsModal" data-row-index="${rowIndex}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>`
            );
          },
        });

        this.allColumns = columnsConfig;
      }

      getFiltered() {
        this.syncColumnsState({ to: 'columns' });
        let data = this.beetles;

        return {
          columns: this.allColumns.map((col) => ({
            name: col.name,
            sort: col.sort,
            hidden: !col.visible,
            formatter: col.formatter,
          })),
          data,
        };
      }

      renderTable() {
        const currentSearch =
          document.querySelector('.gridjs-search input')?.value || '';

        const { columns, data } = this.getFiltered();

        if (!this.grid) {
          this.grid = new gridjs.Grid({
            columns,
            data,
            resizable: true,
            sort: true,
            search: true,
            pagination: { enabled: true, limit: 25 },
            language: {
              search: { placeholder: '–ü–æ–∏—Å–∫ –ø–æ —Ç–∞–±–ª–∏—Ü–µ...' },
              pagination: {
                previous: '–ù–∞–∑–∞–¥',
                next: '–í–ø–µ—Ä–µ–¥',
                showing: '–ü–æ–∫–∞–∑–∞–Ω–æ —Å',
                to: '–ø–æ',
                of: '–∏–∑',
                results: '—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
              },
              loading: '–ó–∞–≥—Ä—É–∑–∫–∞...',
              noRecordsFound: '–ó–∞–ø–∏—Å–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ',
            },
            className: {
              table: 'table table-bordered table-striped table-hover table-sm',
              thead: 'table-dark',
            },
            style: {
              td: { padding: '6px' },
              table: { fontSize: '14px' },
            },
          }).render(document.getElementById('table-wrapper'));
        }

        this.grid
          .updateConfig({ columns: columns, search: { keyword: currentSearch } })
          .forceRender();
      }

      bindEvents() {
        $('.column-toggle').on('change', () => this.renderTable());
      }

      bindToggleAllSwitch() {
        const toggleAll = $('#toggleAllColumns');
        toggleAll.on('change', () => {
          const isChecked = toggleAll.prop('checked');
          $('.column-toggle').prop('checked', isChecked).trigger('change');
        });
      }

      bindHighlightColumns() {
        const columns = this.allColumns;
        $('.form-switch').on('mouseenter', function () {
          const $input = $(this).find('input');
          const colId = $input.val();
          if (!$input.prop('checked')) return;

          const visibleCols = columns.filter((c) => c.visible).map((c) => c.id);
          const visibleIndex = visibleCols.indexOf(colId);
          if (visibleIndex === -1) return;

          $('#table-wrapper table tr').each((_, row) => {
            $(row)
              .find(`td:eq(${visibleIndex}), th:eq(${visibleIndex})`)
              .addClass('highlight-column');
          });
        });

        $('.form-switch').on('mouseleave', function () {
          $('#table-wrapper table td, #table-wrapper table th').removeClass(
            'highlight-column'
          );
        });
      }

      fillFieldset() {
        this.allColumns.forEach((child) => {
          if (!['–í–∏–¥', '–î–µ–π—Å—Ç–≤–∏—è'].includes(child.name) && child.visible) {
            let id = child.id;
            let name = child.name.replace(' –≥—Ä—É–ø–ø–∞', '');
            $('#chooseColumns').append(
              `<div class="form-check form-switch">
                        <input class="form-check-input column-toggle" type="checkbox" value="${id}"
                            checked id="check_${id}">
                        <label class="form-check-label" for="check_${id}">${name}</label>
                    </div>`
            );
          }
        });
      }
    }

    const manager = new TableManager('eco');
    $(document).ready(() => manager.init());

    function populateModalSelects(modalId, currentBeetleData = []) {
      let names = ['families', 'tribes', 'genus', 'subgenus', 'species', 'regions', 'points', 'width_range', 'long_range', 'ecologic_group', 'trophic_group', 'description']
      for (let i = 0; i < names.length - 1; i++) {
        let name = names[i];
        let id = '#' + modalId + "_" + name
        let value = currentBeetleData[i]
        if (['families', 'tribes', 'genus', 'subgenus', 'regions', 'points'].includes(name)) {
          let options = [];
          value?.split(", ").map(element => {
            if (name == 'regions' && element != '–£–ª–∞–Ω-–£–¥—ç') element += ' —Ä–∞–π–æ–Ω';
            options.push($(`option[name="${element}"]`).val());
          });
          value = options;
        }
        $(id).val(value).trigger('change');
      }
    }

    const detailsModal = document.getElementById('detailsModal');
    detailsModal.addEventListener('show.bs.modal', function (e) {
      const button = e.relatedTarget;
      const rowIndex = button.getAttribute('data-row-index');
      const beetle = manager.beetles[rowIndex];
      $('#edit_id').val(rowIndex);
      populateModalSelects('edit', beetle);
      $('#edit_species').val(beetle[4]);
      $('#edit_description').text(beetle[12] || '');
    });



    function submitForm() {
      const button = event.target;
      console.log('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞:', button.name);
    }

    $('#createBeetleBtn').on('click', function () {
      console.log('–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∂—É–∂–µ–ª–∏—Ü—ã');
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–µ–∫—Ü–∏–π –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
    $('.toggle-geography').on('click', function () {
      const modal = $(this).closest('.modal');
      const geographySection = modal.find('[id^="geography-section"]');
      const button = $(this);

      geographySection.slideToggle(200, function () {
        const isVisible = geographySection.is(':visible');
        button.text(isVisible ? '—Å–∫—Ä—ã—Ç—å' : '–ø–æ–∫–∞–∑–∞—Ç—å');
        button.attr('title', isVisible ? '–°–∫—Ä—ã—Ç—å –ø–æ–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏');
      });
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å–µ–∫—Ü–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    $('.toggle-images').on('click', function () {
      const modal = $(this).closest('.modal');
      const imagesSection = modal.find('[id^="images-section"]');
      const button = $(this);

      imagesSection.slideToggle(200, function () {
        const isVisible = imagesSection.is(':visible');
        button.text(isVisible ? '—Å–∫—Ä—ã—Ç—å' : '–ø–æ–∫–∞–∑–∞—Ç—å');
        button.attr('title', isVisible ? '–°–∫—Ä—ã—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏' : '–ü–æ–∫–∞–∑–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏');
      });
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    $('#edit_image, #create_image').on('change', function () {
      const file = this.files[0];
      const modal = $(this).closest('.modal');
      const preview = modal.find('[id^="image-preview"]');

      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.html(`<img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">`);
        };
        reader.readAsDataURL(file);
      }
    });



    // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    $(document).on('click', '[id^="delete-image"]', function () {
      const modal = $(this).closest('.modal');
      const preview = modal.find('[id^="image-preview"]');
      const input = modal.find('input[type="file"]');
      preview.html('<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+CiAgPHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNiIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zNWVtIj7QndC10YIg0LjQt9C+0LHRgNCw0LbQtdC90LjRjzwvdGV4dD4KICA8L3N2Zz4K" class="img-thumbnail" style="max-width: 200px; max-height: 150px;">');
      input.val('');
    });
  </script>
</body>

</html>